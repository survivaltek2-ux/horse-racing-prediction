{% extends "base.html" %}

{% block title %}Add New Horse{% endblock %}

{% block content %}
<div class="add-horse-page">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="text-white">
                <i class="fas fa-plus-circle me-2"></i>
                Add New Horse - Racing Performance Focus
            </h1>
            <a href="{{ url_for('races') }}" class="btn btn-outline-light">
                <i class="fas fa-arrow-left me-1"></i>
                Back to Races
            </a>
        </div>

        <div class="row">
            <div class="col-lg-10 mx-auto">
                <div class="card main-card">
                    <div class="card-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
                        <h5 class="mb-0">
                            <i class="fas fa-horse me-2 section-icon"></i>
                            Racing Performance Analysis Form
                        </h5>
                    </div>
            <div class="card-body">
                <form method="POST">
                    {{ form.hidden_tag() }}
                    
                    <!-- Basic Information Section -->
                    <div class="card section-card mb-4">
                        <div class="card-header basic-info-header">
                            <h6 class="mb-0"><i class="fas fa-info-circle me-2 section-icon"></i>Basic Information</h6>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    {{ form.name.label(class="form-label") }}
                                    {{ form.name(class="form-control") }}
                                    {% if form.name.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.name.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-4">
                                    {{ form.age.label(class="form-label") }}
                                    {{ form.age(class="form-control") }}
                                    {% if form.age.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.age.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-4">
                                    {{ form.sex.label(class="form-label") }}
                                    {{ form.sex(class="form-control") }}
                                    {% if form.sex.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.sex.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-4">
                                    {{ form.color.label(class="form-label") }}
                                    {{ form.color(class="form-control") }}
                                    {% if form.color.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.color.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-4">
                                    {{ form.breed.label(class="form-label") }}
                                    {{ form.breed(class="form-control") }}
                                    {% if form.breed.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.breed.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Speed Ratings Section -->
                    <div class="card section-card mb-4">
                        <div class="card-header speed-rating-header">
                            <h6 class="mb-0"><i class="fas fa-tachometer-alt me-2 section-icon"></i>Speed Ratings (Last 5 Races)</h6>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-3">
                                    {{ form.speed_rating_race_1.label(class="form-label") }}
                                    {{ form.speed_rating_race_1(class="form-control") }}
                                    {% if form.speed_rating_race_1.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.speed_rating_race_1.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-3">
                                    {{ form.speed_rating_race_2.label(class="form-label") }}
                                    {{ form.speed_rating_race_2(class="form-control") }}
                                    {% if form.speed_rating_race_2.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.speed_rating_race_2.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-3">
                                    {{ form.speed_rating_race_3.label(class="form-label") }}
                                    {{ form.speed_rating_race_3(class="form-control") }}
                                    {% if form.speed_rating_race_3.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.speed_rating_race_3.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-3">
                                    {{ form.highest_speed_rating_distance.label(class="form-label") }}
                                    {{ form.highest_speed_rating_distance(class="form-control") }}
                                    {% if form.highest_speed_rating_distance.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.highest_speed_rating_distance.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Beaten Lengths Section -->
                    <div class="card section-card mb-4">
                        <div class="card-header beaten-lengths-header">
                            <h6 class="mb-0"><i class="fas fa-ruler me-2 section-icon"></i>Beaten Lengths (Last 5 Races)</h6>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    {{ form.beaten_lengths_race_1.label(class="form-label") }}
                                    {{ form.beaten_lengths_race_1(class="form-control", step="0.1") }}
                                    {% if form.beaten_lengths_race_1.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.beaten_lengths_race_1.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-4">
                                    {{ form.beaten_lengths_race_2.label(class="form-label") }}
                                    {{ form.beaten_lengths_race_2(class="form-control", step="0.1") }}
                                    {% if form.beaten_lengths_race_2.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.beaten_lengths_race_2.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-4">
                                    {{ form.beaten_lengths_race_3.label(class="form-label") }}
                                    {{ form.beaten_lengths_race_3(class="form-control", step="0.1") }}
                                    {% if form.beaten_lengths_race_3.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.beaten_lengths_race_3.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pace Analysis Section -->
                    <div class="card section-card mb-4">
                        <div class="card-header pace-analysis-header">
                            <h6 class="mb-0"><i class="fas fa-clock me-2 section-icon"></i>Pace Analysis</h6>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    {{ form.running_style.label(class="form-label") }}
                                    {{ form.running_style(class="form-control") }}
                                    {% if form.running_style.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.running_style.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-6">
                                    {{ form.pace_versatility.label(class="form-label") }}
                                    {{ form.pace_versatility(class="form-control") }}
                                    {% if form.pace_versatility.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.pace_versatility.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    {{ form.early_pace_ability.label(class="form-label") }}
                                    {{ form.early_pace_ability(class="form-control") }}
                                    {% if form.early_pace_ability.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.early_pace_ability.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-6">
                                    {{ form.late_pace_ability.label(class="form-label") }}
                                    {{ form.late_pace_ability(class="form-control") }}
                                    {% if form.late_pace_ability.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.late_pace_ability.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pedigree Analysis Section -->
                    <div class="card section-card mb-4">
                        <div class="card-header pedigree-header">
                            <h6 class="mb-0"><i class="fas fa-dna me-2 section-icon"></i>Pedigree Analysis</h6>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    {{ form.sire.label(class="form-label") }}
                                    {{ form.sire(class="form-control") }}
                                    {% if form.sire.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.sire.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-6">
                                    {{ form.dam.label(class="form-label") }}
                                    {{ form.dam(class="form-control") }}
                                    {% if form.dam.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.dam.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    {{ form.pedigree_speed_rating.label(class="form-label") }}
                                    {{ form.pedigree_speed_rating(class="form-control") }}
                                    {% if form.pedigree_speed_rating.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.pedigree_speed_rating.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-4">
                                    {{ form.pedigree_stamina_rating.label(class="form-label") }}
                                    {{ form.pedigree_stamina_rating(class="form-control") }}
                                    {% if form.pedigree_stamina_rating.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.pedigree_stamina_rating.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-4">
                                    {{ form.distance_pedigree_suitability.label(class="form-label") }}
                                    {{ form.distance_pedigree_suitability(class="form-control") }}
                                    {% if form.distance_pedigree_suitability.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.distance_pedigree_suitability.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Connections Section -->
                    <div class="card section-card mb-4">
                        <div class="card-header connections-header">
                            <h6 class="mb-0"><i class="fas fa-users me-2 section-icon"></i>Connections</h6>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    {{ form.owner.label(class="form-label") }}
                                    {{ form.owner(class="form-control") }}
                                    {% if form.owner.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.owner.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-4">
                                    {{ form.trainer.label(class="form-label") }}
                                    {{ form.trainer(class="form-control") }}
                                    {% if form.trainer.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.trainer.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-4">
                                    {{ form.jockey.label(class="form-label") }}
                                    {{ form.jockey(class="form-control") }}
                                    {% if form.jockey.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.jockey.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-3">
                                    {{ form.trainer_win_percentage.label(class="form-label") }}
                                    {{ form.trainer_win_percentage(class="form-control", step="0.1") }}
                                    {% if form.trainer_win_percentage.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.trainer_win_percentage.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-3">
                                    {{ form.trainer_win_percentage_distance.label(class="form-label") }}
                                    {{ form.trainer_win_percentage_distance(class="form-control", step="0.1") }}
                                    {% if form.trainer_win_percentage_distance.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.trainer_win_percentage_distance.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-3">
                                    {{ form.trainer_win_percentage_surface.label(class="form-label") }}
                                    {{ form.trainer_win_percentage_surface(class="form-control", step="0.1") }}
                                    {% if form.trainer_win_percentage_surface.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.trainer_win_percentage_surface.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-3">
                                    {{ form.jockey_win_percentage.label(class="form-label") }}
                                    {{ form.jockey_win_percentage(class="form-control", step="0.1") }}
                                    {% if form.jockey_win_percentage.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.jockey_win_percentage.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    {{ form.trainer_jockey_combo_wins.label(class="form-label") }}
                                    {{ form.trainer_jockey_combo_wins(class="form-control") }}
                                    {% if form.trainer_jockey_combo_wins.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.trainer_jockey_combo_wins.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Race Assignment Section -->
                    <div class="card section-card mb-4">
                        <div class="card-header race-assignment-header">
                            <h6 class="mb-0"><i class="fas fa-flag-checkered me-2 section-icon"></i>Race Assignment</h6>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    {{ form.assigned_races.label(class="form-label") }}
                                    {{ form.assigned_races(class="form-control") }}
                                    {% if form.assigned_races.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.assigned_races.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-4">
                                    {{ form.post_position.label(class="form-label") }}
                                    {{ form.post_position(class="form-control") }}
                                    {% if form.post_position.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.post_position.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-4">
                                    {{ form.morning_line_odds.label(class="form-label") }}
                                    {{ form.morning_line_odds(class="form-control", placeholder="3-1") }}
                                    {% if form.morning_line_odds.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.morning_line_odds.errors %}
                                                <small>{{ error }}</small>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button type="button" class="btn btn-secondary me-md-2" onclick="history.back()">
                            <i class="fas fa-times me-1"></i>
                            Cancel
                        </button>
                        {{ form.submit(class="btn btn-submit") }}
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
</div>

<script>
// Add some client-side validation and UX improvements
document.addEventListener('DOMContentLoaded', function() {
    // Auto-calculate average speed rating
    const speedFields = ['speed_rating_race_1', 'speed_rating_race_2', 'speed_rating_race_3'];
    speedFields.forEach(fieldName => {
        const field = document.getElementById(fieldName);
        if (field) {
            field.addEventListener('input', function() {
                // Add visual feedback for speed ratings
                const value = parseInt(this.value);
                if (value >= 100) {
                    this.style.borderColor = '#28a745'; // Green for excellent
                } else if (value >= 80) {
                    this.style.borderColor = '#ffc107'; // Yellow for good
                } else if (value >= 60) {
                    this.style.borderColor = '#fd7e14'; // Orange for average
                } else if (value > 0) {
                    this.style.borderColor = '#dc3545'; // Red for poor
                } else {
                    this.style.borderColor = '#ced4da'; // Default
                }
            });
        }
    });

    // Add tooltips for better UX
    const tooltips = {
        'speed_rating_race_1': 'Enter the speed rating from the horse\'s most recent race (0-130)',
        'beaten_lengths_race_1': 'Enter how many lengths the horse was beaten by (0 if won)',
        'running_style': 'Select the horse\'s typical position during the race',
        'pedigree_speed_rating': 'Rate the pedigree\'s speed potential based on sire/dam lineage'
    };

    Object.keys(tooltips).forEach(fieldName => {
        const field = document.getElementById(fieldName);
        if (field) {
            field.setAttribute('title', tooltips[fieldName]);
        }
    });
});
</script>
{% endblock %}